langcode: en
status: true
dependencies:
  module:
    - eca_content
    - eca_log
    - user
id: user_email_change
modeller: core
label: 'User Email Change'
version: ''
weight: 0
events:
  content_entity_update:
    plugin: 'content_entity:update'
    label: 'Update content entity'
    configuration:
      type: 'user user'
    successors:
      -
        id: action_send_email_action
        condition: eca_entity_field_value_changed
      -
        id: eca_write_log_message
        condition: eca_entity_field_value_changed
conditions:
  eca_entity_field_value_changed:
    plugin: eca_entity_field_value_changed
    configuration:
      field_name: mail
      negate: false
      entity: ''
gateways: {  }
actions:
  action_send_email_action:
    plugin: action_send_email_action
    label: 'Send email'
    configuration:
      recipient: '[user:original:mail]'
      subject: 'E-mail changed'
      message: 'Your email has been changed from [user:original:mail] to [user:mail] by [current-user:account-name]'
      replace_tokens: false
    successors: {  }
  eca_write_log_message:
    plugin: eca_write_log_message
    label: 'Log Message'
    configuration:
      channel: eca_log_email_change
      severity: '5'
      message: 'Your email has been changed from [user:original:mail] to [user:mail] by [current-user:account-name]'
    successors: {  }
